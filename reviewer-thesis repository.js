// Sample thesis data
let thesisData = [
    {
        id: 1,
        title: "Solar Powered Automated Waste Restraining Device for Sewages",
        authors: "Ruby Rosa N. Puno, Kristine E. Pineda, Jan Michael P. Canlas, Erick Carl G. Leabres, Anton Micael O. Mallari, Marvin S. Mallari, Mark Allen L. Manlutac",
        department: "Computer Engineering",
        dateSubmitted: "December 20, 2023",
        status: "approved",
        abstract: "In the community, waste is the reason why small-scale sewages or canals are clogging. It is also one of the reasons why floods and long-term floods occur. The study aims to mitigate these specific problems. The research study strived to develop a device specifically for restraining waste floating on a small-scale sewage or canal. Clogged sewage is a blockage of the drainage system that causes the water not to drain, resulting in frequent back-ups such as floods. Blockages are often caused by debris like plastic, dried leaves, pet bottles, etc. The researchers came up with a solution that can help collect substances from clogged sewage to avoid future setbacks. The study proposed a device named 'Solar Powered Automated Waste Restraining Device for Sewages.' This equipment will prevent the sewages from clogging by restraining and collecting debris on a free-flowing canal using an ultrasonic sensor. This device will automatically send notifications using the GSM module to authorized personnel to repeat the process until the sewage system is clogged-free.",
        pdfUrl: "#"
    },
    {
        id: 2,
        title: "ROBUMBERO: SMART FIREFIGHTING ROBOT",
        authors: "Asil Kastle S. Dela Cruz, Grosby A. Dela Cruz, Karl Angelo T. Garcia, Yashtroi Jerwin C. Oriel,Karl Martin G. Perez, John Niel L. Pineda, Kendrich S. Tienzo",
        department: "Computer Engineering",
        dateSubmitted: "December 20, 2023",
        status: "approved",
        abstract: "This study aimed to develop a fire-fighting robot called Robumbero. This smart firefighting robot can be operated automatically or manually using a remote control. It can extinguish fires at an early phase without the actual presence of the firefighters and without exposing one's self to the danger of fire. It is equipped with an ABC fire extinguisher, and sensors to detect fire and obstructions. It also has a camera that allows users to have a real-time view of the robot's surroundings for easy manipulation. The robot's overall performance was assessed using a descriptive research method. It was evaluated by the twenty students and employees from Don Honorio Venture State University, BFP and ten engineers. The data obtained were analyzed and it was revealed that the robot has met all the criteria of ISO25010 and that its overall performance can be deemed efficient and effective.",
        pdfUrl: "#"
    },
    {
        id: 3,
        title: "E-CHEQUER: A SMART EXAM -CHECKING MACHINE USING IMAGE PROCESSING TECHNIQUE",
        authors: "Ruby Rosa N. Puno, Yuen A. Nicdao, Christian Devan Sen Deinla, Gabriel Hernandez, Milongy Javier, Dhenzel Macalino, Renniel Ocampo, Jobert Santos, Gio Sicat",
        department: "Computer Engineering",
        dateSubmitted: "December 20, 2023",
        status: "approved",
        abstract: "This study developed an E-Chequer: A Smart Exam-Checking Machine Using Image Processing Technique. The research aims to identify the feasibility and effectiveness of using image processing techniques for automated exam grading among secondary level teachers in public schools.Specifically, it aims to (1) to develop a system that will help secondary-level teachers in terms of functionality, reliability, efficiency, and usability in checking the exams, (2) to identify the significant differences between the conventional way and the designed project in terms of checking exams. (3) tobuild a machine that will help the secondary level teachers lessen their workload. A great significance of this study is speed and efficiency when it comes to checking, assessment and data analysis of the students' exam papers. A machine can check a large amount of papers in a small amount of time compared to a human teacher. A Developmental Research Method concept was employed with 15 preliminary respondents and 13 evaluators, that includes secondary level teachers and professionals. The data were analyzed using statistical analysis. The device obtained an error rate of 1.33%, a precision of 100%, a recall of 96%, and an F1 score of 97.96%. Moreover, the accuracy of the device, based on the calculated Precision, Recall, and F1 Score, is 96%. The overall rating for the design project is 4.25 out of 5, showing that the respondents AGREE that the device meets the standard features and characteristics for property evaluation and serves the needs of the stakeholders, and so holds value. The device can perform bulk checking, and the scanning rate is only 9 exam papers per minute. Also, it only accepts A5 paper size and is limited to the customized answer sheet and 50 items only. For the volume of the exam paper, it can handle a maximum of 50 exam papers in one go. The contributing factors to paper jams include the  quality and condition of the paper used and incorrect loading of the paper tray..",
        pdfUrl: "#"
    },
    {
        id: 4,
        title: "DESIGN AND DEVELOPMENT OF AUTOMATED SOLDERING ROBOT MACHINE ",
        authors: "Ruby Rosa N. Puno, Asil Kastle S. Dela Cruz, Humphrey John S. Alarios, Toby R. Castro, John Patrick S. Guiao, Cassell L. Lozano, John Mark V. Pangilinan, Avie D. Sanchez",
        department: "Computer Engineering",
        dateSubmitted: "December 20, 2023",
        status: "approved",
        abstract: "The Soldering Robot Machine was a clever, portable automated PCB assembly equipment that was the subject of this research project. The tool uses Arksoft Mach3 and Aspire software to drill and solder holes using the G-Code programming language. The researchers used a descriptive and experimental design method, drawing on their experience integrating hardware and software, and they iteratively tried and failed to create the device. PCB enthusiasts, designers, and experts evaluated the Soldering Robot Machine to determine its usability, functionality, portability, reliability, and efficiency. The obtained results from the evaluation were utilized to describe the device, ascertain its functionality, and establish its acceptability. The device was described, its functionality was established, and its acceptance was established using the evaluation findings that were received. Various electronic and electrical components were used o build the device, and experimental design showed it has successfully located processes and performed drilling characterization, proving its potential for PCBmanufacture.",
        pdfUrl: "#"
    },
    {
        id: 5,
        title: "Automated LCD Masked-Based Lithography PCB Layout Etching System",
        authors: "Asil Kastle S. Dela Cruz, Arvee L. Domingo, Jhester John M. De Leon, Carolyn L. Jimenez, Angelica B. Manalang, Hazelyn R. Mendoza, Jovy Abegail D. Sanchez, and Alliah Nhel C. Vitug  ",
        department: "Computer Engineering",
        dateSubmitted: "December 20, 2023",
        status: "approved",
        abstract: "The manual pre-sensitizing method usually takes about 30 minutes to an hour, which is very time-consuming and difficult since finding services that print on acetate film is challenging. Implementing manual procedures is also prone to inaccurate results and even exposes the user to various health and safety hazards. Instead of utilizing an acetate film, a transparent monitor was used as the layout mask by displaying the layout on it and letting the UV light pass through to the transparent areas. Exposing, developing, and etching were automated, which reduced potential risks and hazards. With automation and LCD-Masked Based Lithography, the process of printing layouts on acetate film for layout masking can be eliminated, and printing  layouts can be done safely and conveniently. The system could etch layouts on pre-sensitized PCBs within 16 minutes, faster than the manual method. Etched PCBs have 100% accuracy and 84% precision. Essentially, the system has obtained a weighted mean of 3.69 from the student respondents and 3.57 from the professional respondents, which, based on its equivalent descriptive rating, implies an excellent performance for achieving its objectives .",
        pdfUrl: "#"
    },
    {
        id: 6,
        title: "AUTOMATIC TURN SIGNAL FOR MOTOR VEHICLES USING ROAD NAVIGATION APPLICATION",
        authors: "Asil Kastle S. Dela Cruz, Mark Joren C. Guinto, Christian Dale G. Bondoc, Kaniel Ezekiel Ang Faina, Rei Rose P. Paras, Myka G. Puerto, and Jan Roi S. Sison",
        department: "Computer Engineering",
        dateSubmitted: "December 20, 2023",
        status: "pending",
        abstract: "One of the causes of the traffic accidents is drivers making sudden and unexpected turns and failing to use their turn signals correctly. This Automatic Turn Signal for Motor Vehicles using Road Navigation Application aims to create a device that connects to a road navigation application and automatically activates turn signals of a motor vehicle. The system is designed to control the vehicle's turn signal lights by detecting the need of turning and assist the user in navigating to the desired location using the directions generated from Google Maps API. This study employed Developmental Quantitative research and Iterative Waterfall method in its development. A control box is installed to a motor vehicle which contains Atmega328P as its main controller, a relay to switch the turn signal lights and a HC-05 module to communicate with the mobile app through Bluetooth technology. System Testing was done toensure that the device is working according to specification, the following were tested: unit testing, communication with the API, turn point detection, communication between hardware and software modules. The results show that the mobile app, control box and the API were successfully integrated.",
        pdfUrl: "#"
    },
];

// Global variables
let currentPage = 1;
const itemsPerPage = 5;
const defaultDepartment = "computer-engineering";
let filteredData = thesisData.filter(thesis => 
    thesis.department.toLowerCase().replace(/\s+/g, '-') === defaultDepartment
);

// DOM elements
let searchInput, searchButton, departmentFilter, yearFilter, statusFilter, thesisTable, pagination;

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Get DOM elements
    searchInput = document.getElementById('search-input');
    searchButton = document.getElementById('search-button');
    departmentFilter = document.getElementById('department-filter');
    yearFilter = document.getElementById('year-filter');
    statusFilter = document.getElementById('status-filter');
    thesisTable = document.getElementById('thesis-table');
    pagination = document.querySelector('.pagination');
    
    // Set default department filter to Computer Engineering
    if (departmentFilter) {
        departmentFilter.value = defaultDepartment;
    }
    
    renderThesisTable();
    setupPagination();
    setupEventListeners();
});

// Setup all event listeners
function setupEventListeners() {
    // Search functionality
    searchButton.addEventListener('click', performSearch);
    searchInput.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    // Filter change events
    departmentFilter.addEventListener('change', applyFilters);
    yearFilter.addEventListener('change', applyFilters);
    statusFilter.addEventListener('change', applyFilters);

    // Close button for modal
    const closeButtons = document.querySelectorAll('.modal .close');
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const modal = this.closest('.modal');
            modal.style.display = 'none';
        });
    });

    // Close modal when clicking outside
    window.addEventListener('click', function(e) {
        const modal = document.getElementById('view-thesis-modal');
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });

    // Begin Review button in view modal
    const beginReviewBtn = document.querySelector('.begin-review-btn');
    if (beginReviewBtn) {
        beginReviewBtn.addEventListener('click', function() {
            window.location.href = 'reviewer.html';
        });
    }
}

// Search functionality
function performSearch() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    const departmentValue = departmentFilter.value;
    
    // Always filter by department (if selected)
    let departmentFiltered = thesisData;
    if (departmentValue !== '') {
        departmentFiltered = thesisData.filter(thesis => 
            thesis.department.toLowerCase().replace(/\s+/g, '-') === departmentValue
        );
    }
    
    // Then apply search term if provided
    if (searchTerm === '') {
        filteredData = [...departmentFiltered];
    } else {
        filteredData = departmentFiltered.filter(thesis => 
            thesis.title.toLowerCase().includes(searchTerm) ||
            thesis.authors.toLowerCase().includes(searchTerm) ||
            thesis.abstract.toLowerCase().includes(searchTerm)
        );
    }
    
    currentPage = 1;
    renderThesisTable();
    setupPagination();
}

// Apply filters
function applyFilters() {
    const departmentValue = departmentFilter.value;
    const yearValue = yearFilter.value;
    const statusValue = statusFilter.value;
    
    filteredData = thesisData.filter(thesis => {
        const departmentMatch = departmentValue === '' || 
            thesis.department.toLowerCase().replace(/\s+/g, '-') === departmentValue;
        
        const yearMatch = yearValue === '' || 
            thesis.dateSubmitted.includes(yearValue);
        
        const statusMatch = statusValue === '' || 
            thesis.status === statusValue;
        
        return departmentMatch && yearMatch && statusMatch;
    });
    
    currentPage = 1;
    renderThesisTable();
    setupPagination();
}

// Render thesis table with current filtered data
function renderThesisTable() {
    const tbody = thesisTable.querySelector('tbody');
    tbody.innerHTML = '';
    
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedData = filteredData.slice(startIndex, endIndex);
    
    if (paginatedData.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="6" style="text-align: center;">No thesis records found</td>`;
        tbody.appendChild(tr);
    } else {
        paginatedData.forEach(thesis => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${thesis.title}</td>
                <td>${thesis.authors}</td>
                <td>${thesis.department}</td>
                <td>${thesis.dateSubmitted}</td>
                <td><span class="status-badge ${thesis.status}">${thesis.status.charAt(0).toUpperCase() + thesis.status.slice(1)}</span></td>
                <td class="action-buttons">
                    <button class="view-btn" title="View" data-id="${thesis.id}"><i class="fas fa-eye"></i></button>
                    <button class="download-btn" title="Download" data-id="${thesis.id}"><i class="fas fa-download"></i></button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }
    
    setupActionButtons();
}

// Setup pagination
function setupPagination() {
    const totalPages = Math.ceil(filteredData.length / itemsPerPage);
    pagination.innerHTML = '';
    
    // First and previous buttons
    pagination.innerHTML += `
        <button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} data-page="first"><i class="fas fa-angle-double-left"></i></button>
        <button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} data-page="prev"><i class="fas fa-angle-left"></i></button>
    `;
    
    // Page numbers
    const startPage = Math.max(1, currentPage - 1);
    const endPage = Math.min(totalPages, startPage + 2);
    
    for (let i = startPage; i <= endPage; i++) {
        pagination.innerHTML += `
            <button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>
        `;
    }
    
    // Next and last buttons
    pagination.innerHTML += `
        <button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} data-page="next"><i class="fas fa-angle-right"></i></button>
        <button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} data-page="last"><i class="fas fa-angle-double-right"></i></button>
    `;
    
    // Add event listeners to pagination buttons
    const pageButtons = pagination.querySelectorAll('.page-btn');
    pageButtons.forEach(button => {
        button.addEventListener('click', function() {
            if (this.hasAttribute('disabled')) return;
            
            const pageAction = this.getAttribute('data-page');
            
            if (pageAction === 'first') {
                currentPage = 1;
            } else if (pageAction === 'prev') {
                currentPage--;
            } else if (pageAction === 'next') {
                currentPage++;
            } else if (pageAction === 'last') {
                currentPage = totalPages;
            } else {
                currentPage = parseInt(pageAction);
            }
            
            renderThesisTable();
            setupPagination();
        });
    });
}

// Setup action buttons
function setupActionButtons() {
    // View buttons
    const viewButtons = document.querySelectorAll('.view-btn');
    viewButtons.forEach(button => {
        button.addEventListener('click', function() {
            const thesisId = this.getAttribute('data-id');
            const thesis = thesisData.find(t => t.id == thesisId);
            
            if (thesis) {
                const modal = document.getElementById('view-thesis-modal');
                modal.querySelector('.thesis-title').textContent = thesis.title;
                modal.querySelector('.thesis-authors').textContent = thesis.authors;
                modal.querySelector('.thesis-department').textContent = thesis.department;
                modal.querySelector('.thesis-date').textContent = thesis.dateSubmitted;
                modal.querySelector('.thesis-status').textContent = thesis.status.charAt(0).toUpperCase() + thesis.status.slice(1);
                modal.querySelector('.thesis-abstract').textContent = thesis.abstract;
                
                modal.style.display = 'block';
            }
        });
    });
    
    // Download buttons
    const downloadButtons = document.querySelectorAll('.download-btn');
    downloadButtons.forEach(button => {
        button.addEventListener('click', function() {
            const thesisId = this.getAttribute('data-id');
            const thesis = thesisData.find(t => t.id == thesisId);
            
            if (thesis) {
                alert(`Downloading thesis: ${thesis.title}`);
                // In a real application, this would initiate a download
                console.log(`Download initiated for thesis ID: ${thesisId}`);
            }
        });
    });
}

// Confirm logout function
function confirmLogout() {
    return confirm('Are you sure you want to logout?');
}